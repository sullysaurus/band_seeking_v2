<turbo-frame id="youtube_section">
  <div class="bg-white shadow rounded-lg p-4">
    <div class="mb-4" data-controller="youtube-url">
      <div class="flex items-center mb-2">
        <svg class="w-5 h-5 text-gray-500 mr-2" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19.615 3.184C18.351 2.65 12 2.65 12 2.65s-6.351 0-7.615.533C2.75 3.184 2 4.177 2 5.534v12.931c0 1.357.75 2.35 2.385 2.35C5.649 21.35 12 21.35 12 21.35s6.35 0 7.615-.535c1.634-.535 2.384-1.528 2.384-2.886V5.534c0-1.357-.75-2.35-2.384-2.35zM10 15V9l5 3-5 3z"/>
        </svg>
        <h3 class="font-bold text-lg">YouTube</h3>
      </div>

      <% if profile.youtube_url.present? %>
        <div class="relative aspect-video rounded-lg overflow-hidden bg-gray-100"
             data-youtube-url-target="videoContainer">
          <iframe 
            src="<%= profile.youtube_url.gsub('watch?v=', 'embed/') %>"
            class="absolute inset-0 w-full h-full"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
          <div class="absolute top-2 right-2 flex gap-2">
            <button class="p-1 bg-blue-500 text-white rounded-full hover:bg-blue-600"
                    data-action="youtube-url#showEditForm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
              </svg>
            </button>
            <button class="p-1 bg-red-500 text-white rounded-full hover:bg-red-600"
                    data-action="youtube-url#removeVideo">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Edit Form -->
        <div class="hidden mt-2" data-youtube-url-target="editForm">
          <%= form_with(model: profile, data: { action: "submit->youtube-url#save" }) do |f| %>
            <div class="flex flex-col gap-2">
              <div class="relative flex-1">
                <%= f.text_field :youtube_url,
                    value: profile.youtube_url,
                    class: "w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                    placeholder: "https://www.youtube.com/watch?v=...",
                    data: { 
                      youtube_url_target: "editInput",
                      action: "keydown->youtube-url#handleKeydown"
                    } %>
              </div>

              <div class="flex gap-2">
                <button type="submit" 
                        class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                  Update
                </button>
                <button type="button" 
                        class="px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-sm"
                        data-action="youtube-url#cancelEdit">
                  Cancel
                </button>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="aspect-video rounded-lg bg-gray-100 flex items-center justify-center cursor-pointer group"
             data-youtube-url-target="addButton"
             data-action="youtube-url#showForm">
          <div class="text-gray-400 group-hover:text-gray-600 transition-colors">
            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            <span class="block text-sm mt-2">Add YouTube Video</span>
          </div>
        </div>

        <div class="hidden" data-youtube-url-target="form">
          <%= form_with(model: profile, data: { action: "submit->youtube-url#save" }) do |f| %>
            <div class="mt-2">
              <div class="relative">
                <%= f.text_field :youtube_url,
                    class: "w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                    placeholder: "https://www.youtube.com/watch?v=...",
                    data: { 
                      youtube_url_target: "input",
                      action: "keydown->youtube-url#handleKeydown"
                    } %>
              </div>

              <div class="flex gap-2 mt-2">
                <button type="submit" 
                        class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm">
                  Add Video
                </button>
                <button type="button" 
                        class="px-3 py-1 bg-gray-100 text-gray-700 rounded hover:bg-gray-200 text-sm"
                        data-action="youtube-url#cancel">
                  Cancel
                </button>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</turbo-frame>
