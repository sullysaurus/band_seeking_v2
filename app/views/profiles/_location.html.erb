<turbo-frame id="location_frame">
  <div class="inline-flex items-center gap-3 bg-blue-50 px-3 py-1.5 rounded-full mb-6 text-sm" 
       data-controller="location">
    
    <!-- Display State -->
    <div data-location-target="display" 
         data-action="click->location#showEdit"
         class="flex items-center text-blue-700 cursor-pointer">
      <svg class="h-4 w-4 text-blue-500 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      <span>
        <%= params[:zip_code] || current_user&.profile&.zip_code || "All Locations" %>
      </span>
    </div>

    <!-- Edit Form -->
    <div data-location-target="form" class="hidden">
      <%= form_with(model: current_user.profile,
            url: profile_path(current_user.profile),
            class: "flex items-center gap-2", 
            data: { 
              turbo_frame: "location_frame"
            }) do |f| %>
        <%= f.text_field :zip_code, 
            placeholder: "Enter zip",
            class: "w-24 bg-transparent border-none text-blue-700 focus:ring-0 p-0 text-sm",
            data: { 
              location_target: "input",
              action: "keydown->location#handleKeydown"
            } %>
        
        <div class="flex gap-2">
          <%= f.submit "Update", 
              class: "text-blue-600 hover:text-blue-800 text-sm font-medium bg-transparent py-0.5" %>
          <button type="button" 
                  class="text-gray-500 hover:text-gray-700 text-sm font-medium"
                  data-action="location#cancel">
            Cancel
          </button>
        </div>
      <% end %>
    </div>

    <% if params[:zip_code].present? || (current_user&.profile&.zip_code.present? && !params[:show_all]) %>
      <%= link_to "Show All", profiles_path(show_all: true), 
          class: "text-gray-500 hover:text-gray-700 text-sm font-medium" %>
    <% end %>
  </div>
</turbo-frame>